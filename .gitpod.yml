tasks:
  - init: |
      # Install Miniconda
      echo "Downloading and Installing Miniconda"
      wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
      bash miniconda.sh -b -p /home/gitpod/miniconda
      eval "$(/home/gitpod/miniconda/bin/conda shell.bash hook)"
      conda init
      conda activate
      echo "Removing Miniconda Installer Script"
      rm miniconda.sh
      echo "Getting Folder"
      FOLDER=$(echo $GITPOD_WORKSPACE_CONTEXT | jq -r '.normalizedContextURL' | awk -F'/' '{print $NF}')
      cd "$FOLDER"
      echo "Creating Conda environment from environment YAML"
      conda env create -f environment.yml
      echo "Success!"